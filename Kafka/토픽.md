# 토픽

카프카를 사용하는 것은 토픽을 만들면서 시작된다.
이는 토픽을 잘 알고 사용하는 것이 카프카에 대한 활용도를 높이는 길

## 적정 파티션 개수

토픽의 파티션 개수는 카프카의 성능과 관련이 있다. 그렇기 때문에 토픽을 운영함에 있어 적절한 파티션 개수를 성정하고 운영하는 것이 매우 중요하다.

### 토픽 생성 시 파티션 개수 고려사항

- 데이터 처리량
- 메시지 키 사용 여부
- 브로커, 컨슈머 영향도

파티션은 카프카의 병렬처리 핵심
파티션의 개수가 많아지면 많아질수록 1:1 매핑되는 컨슈머 개수가 늘어나기 때문
그렇기 때문에 파티션 개수를 정할 때 해당 토픽에 필요한 데이터 처리량을 측정하여 정하는 것이 중요

데이터 처리 속도를 올리는 방법은 2가지다
- 컨슈머의 처리량을 늘리기
- 컨슈마를 추가해서 병렬처리량을 늘리기

컨슈머의 처리량을 늘릴려면 스케일 업하거나 GC 튜닝 등 활용할 수 있지만 일정 수준 이상 처리량을 올리는 것은 매우 어렵다.

하지만 컨슈머를 추가하는 방법은 데이터 처리량을 늘리는 가장 확실한 방법

프로듀서 < 컨슈머 데이터 처리량 X 최소 파티션 개수

파티션 개수만큼 컨슈머 스레드를 운영한다면 해당 토픽의 병렬처리를 극대화할 수 있다 만약 처리량이 데이터의 양보다 적다면 렉이 발생하게 될것이다.

처리량을 구하는 방법은 상용에서 운영 중인 카프카에서 더미 데이터로 테스트를 해보는 것
카프카 컨슈머를 개발할 때 내부 로직을 고민하여 시간 복잡도를 줄인다면 더욱 좋다.
하지만 카프카 클러스터와 다른 시스템등이 연결되어 있기 때문에 개발 환경과 운영환경의 데이터 처리량은 차이가 날 확률이 높다.

그렇기 때문에 상용환경에서 테스트를 권장
컨슈머 데이터 처리량을 구한 뒤 프로듀서가 보내는 데이터양을 하루,시간,분, 단위로 쪼개서 에측

그리고 지연이 발생 되어도 되느냐 아니면 발생되지 않아야하느냐로 데이터 생성량의 최대치를 계산할 수 있다.

그리고 파티션의 개수를 늘리는것도 능사는 아니다 파티션 개수를 늘리면 결국에는 컨슈머, 브로커에 부담이 된다. 그렇기 때문에 영향을 잘 고려하는것이 중요



