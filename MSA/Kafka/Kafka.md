Scalar 언어로 된 오픈 소스 메시지 브로커 프로젝트

이벤트 드리븐 아키텍처와 스트림 데이터 파이프라인

여기서 메시지 브로커란
특정한 리소스에서 다른 쪽에 있는 리소스 또는 서비스 시스템으로 메시지를 전달할 때 사용되는 서버

즉 메세지를 전달시켜주는 역활을 하는 것이 메세지 서버, 메시지 브로커라고 보면 된다.

Producer/Consumer 분리 할 수 있다.

3개 이상의 브로커를 가지고 있는 클러스터링 구조 구성
브로커의 문제가 생겼을 경우 다른 브로커를 사용할 수 있어서 안전하게 메시지를 계속해서 사용할 수 있게 된다.

그리고 서버의 상태나, 서버의 리더, 문제에 대한 장애를 관리해주기 위한 코디네이터 시스템인 주키퍼를 같이 연동해서 사용하는 것이 일반적이다.

일반적인 사용방법
카프카 클라이언트

카프카에는 세가지가 존재한다.
Producer, Kafka Broker, Consumer

Producer : Broker에 데이터를 보내는 역활
Consumer  : Broker에 적재 되어 있는 데이터를 가져오는 역활

데이터가 전달되고 적재 되는 과정에서 정상적으로 수행이 되고 있는지를 알기 위해
Producer는 Acknowledgement Consumer는 Offset commit으로 확인 하게된다.

데이터를 담는 Topic, Partition, Offset으로 잘 처리 되었는지 확인한다.

네트워크 장애로 Acknowledgement 장애가 있는 경우 다시 보내게 된다.
이과정에서 중복된 데이터가 적재될 수 있으므로 카프카는  중복된 적재를 막기 위해멱등성 프로듀서를 사용하게 된다.

멱등성 프로듀서(Idempotence Producer)
카프카 3.0부터는 기본적으로 true로 사용하게 된다.
멱등성 프로듀서는 기본적인 프로듀서와 다르게 레코드를 브로커로 전송할 때 PID(Producer unique Id)와 SEQ(Sequence Number)를 전송하게 된다.

브로커는 PID와 SEQ를 가지고 있다가 중복 적재 요청이 오면 이후에 요청된 중복 레코드는 적재하지 않는다.

비동기 프로듀서로 작업해야 제대로 이 멱등성 프로듀서를 사용할 수 있다.
Producer가 Broker에 데이터를 보낼 때 PID와 SEQ가 함께 가게 되는데 이를 통해 중복을 피하게 된다.

Topic to Topic
변경이 되지 않고 계속 추가되는 데이터
지속적으로 



카프카 메세지를 신뢰성 있게 전달 하려면
3가지를 지켜야한다.

정확히 한번 - 중복성 금지
적어도 한번, 
최대 한번 - 데이터 유실